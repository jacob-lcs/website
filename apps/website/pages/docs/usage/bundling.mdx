import { Callout, Tab, Tabs } from 'nextra-theme-docs'

# Bundling (swcpack)

<Callout emoji="ğŸš§">
  è¿™ä¸ªåŠŸèƒ½ä»åœ¨å¼€å‘ä¸­ã€‚æ­¤å¤–ï¼ŒSWC çš„ä¸»è¦ä½œè€…åœ¨ Vercel ä¸º [Turbopack](https://github.com/vercel/turbo) å·¥ä½œï¼Œæ‰€ä»¥è¿™ä¸ªåŠŸèƒ½ä¸ä¼šè¢«ç§¯æå¼€å‘ã€‚
</Callout>

SWC èƒ½å¤Ÿå°†å¤šä¸ª JavaScript æˆ– TypeScript æ–‡ä»¶æ†ç»‘åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚

è¿™ä¸ªåŠŸèƒ½ç›®å‰åä¸º `spack`ï¼Œä½†å°†åœ¨ `v2` ä¸­æ›´æ”¹ä¸º `swcpack`ã€‚`spack.config.js` å°†è¢«å¼ƒç”¨ï¼Œæ”¹ä¸º `swcpack.config.js`ã€‚

æŸ¥çœ‹ [ä¸€ä¸ªåŸºæœ¬çš„æ†ç»‘ç¤ºä¾‹](https://github.com/swc-project/pkgs/tree/main/packages/cli/examples/spack-basic)ã€‚

## ç”¨æ³•

<Tabs items={['pnpm', 'npm', 'yarn']}>
  <Tab>
    ```bash copy
    pnpm i -D @swc/cli @swc/core
    ```
  </Tab>
  <Tab>
    ```bash copy
    npm i -D @swc/cli @swc/core
    ```
  </Tab>
  <Tab>
    ```bash copy
    yarn add -D @swc/cli @swc/core
    ```
  </Tab>
</Tabs>

åˆ›å»ºä¸€ä¸ª `spack.config.js` æ–‡ä»¶å¹¶è¿è¡Œï¼š

```bash
npx spack
```

## é…ç½®

è¦æŸ¥çœ‹æ‰€æœ‰é€‰é¡¹ï¼Œè¯·æŸ¥çœ‹ [é…ç½®](/docs/configuration/bundling)ã€‚

## åŠŸèƒ½

### ç´§å‡‘è¾“å‡º

å°±åƒ `rollup`ï¼ŒSWC ä¼šå‘å‡ºç´§å‡‘çš„è¾“å‡ºã€‚

```js filename="a.js"
console.log("loading A");
export function a() {
  console.log("use!");
}
```

```js filename="lib.js"
import { a } from "./a";
a();
```

becomes:

```js filename="output.js"
console.log("loading A");
function a() {
  console.log("use!");
}
a();
```

SWC çš„è®¾è®¡ç›®çš„æ˜¯åˆå¹¶ï¼Œå› æ­¤å¤šä¸ªæ–‡ä»¶ä¹‹é—´çš„å‘½åå†²çªä¼šè‡ªåŠ¨å¤„ç†ã€‚

### æ ‘æ‘‡

å°±åƒå…¶ä»–ç°ä»£æ†ç»‘å™¨ä¸€æ ·ï¼ŒSWC å¯ä»¥åˆ é™¤æœªä½¿ç”¨çš„å¯¼å‡ºã€‚

### å¯¼å…¥å»æŠ–

ä¸ºäº†å¸®åŠ©æ ‘æ‘‡ï¼ŒSWC ä¼šå»æŠ–å¯¼å…¥ã€‚

```js
import * as lib from "lib";
lib.foo();
```

è¡Œä¸ºä¸ä»¥ä¸‹ä»£ç å®Œå…¨ç›¸åŒï¼š

```js
import { foo } from "lib";
foo();
```

è¿™ä¿ç•™äº†æ‰€æœ‰å‰¯ä½œç”¨ã€‚

### CommonJS æ”¯æŒ

SWC æ”¯æŒå¯¼å…¥ CommonJS æ¨¡å—ï¼Œå¹¶å‘å‡ºæ¯” webpack æ›´ç´§å‡‘çš„è¾“å‡ºã€‚

```js filename="source.js"
import * as lib from "lib";
console.log(lib); // Prevent dce
```

å¦‚æœä¸Šé¢çš„ `lib` æ˜¯ CommonJS æ¨¡å—ï¼Œåˆ™ä¼šè¢«è½¬è¯‘ä¸ºï¼š

```js filename="output.js"
const load = __spack_require.bind(void 0, function (module, exports) {
  // Code from lib goes here
});
const lib = load();
console.log(lib); // Prevent dce
```

### ä¼˜åŒ–

- å…¨å±€å†…è”ï¼ˆä¾‹å¦‚ `process.env.NODE_ENV`ï¼‰
- å†…è”
- å¸¸é‡ä¼ æ’­
- æ­»ä»£ç æ¶ˆé™¤

ä¸Šé¢æè¿°çš„æ ‘æ‘‡æ˜¯ä½¿ç”¨æ­»ä»£ç æ¶ˆé™¤ pass å®ç°çš„ã€‚ç›®å‰ï¼ŒSWC å¯ä»¥æ¨æ–­ï¼š

```js filename="source.js"
let b = 2;
let a = 1;
if (b) {
  a = 2;
}
let c;
if (a) {
  c = 3;
}
console.log(c);
```

into:

```js filename="output.js"
console.log(3);
```

### é«˜æ€§èƒ½

æ€§èƒ½æ˜¯ SWC çš„é¦–è¦ä»»åŠ¡ã€‚å®ƒéå¸¸å¿«ï¼Œå› ä¸ºå®ƒä½¿ç”¨æ‰€æœ‰ CPU æ ¸å¿ƒå¹¶ç”± `llvm` ä¼˜åŒ–ã€‚

### å¤šå…¥å£æ”¯æŒ

```js filename="spack.config.js"
const { config } = require("@swc/core/spack");

module.exports = config({
  entry: {
    web: __dirname + "/src/web.ts",
    android: __dirname + "/src/android.ts",
  },
  output: {
    path: __dirname + "/lib",
  },
  module: {},
});
```

### å†…ç½®åˆ†å—

ä½¿ç”¨ä¸ä¸Šé¢ç›¸åŒçš„é…ç½®ï¼Œå¦‚æœ `android.ts` å’Œ `web.ts` éƒ½å¼•ç”¨äº†åŒä¸€ä¸ªæ–‡ä»¶ï¼Œå®ƒå°†è¢«æå–ä¸ºå•ç‹¬çš„å—ï¼Œå¹¶ä¸” `web.ts` å’Œ `android.ts` å°†å¯¼å…¥å®ƒã€‚
